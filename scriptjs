document.addEventListener("DOMContentLoaded", () => {
  // Carregar eventos
  fetch("data/eventos.json")
    .then(res => res.json())
    .then(eventos => {
      const lista = document.getElementById("lista-eventos");
      eventos.forEach(ev => {
        const botao = document.createElement("button");
        botao.textContent = `${ev.nome} â€” ${ev.data}`;
        botao.onclick = () => alert(`ðŸ“… ${ev.nome}\nðŸ“ Local: ${ev.local}\nðŸ•’ ${ev.hora}`);
        lista.appendChild(botao);
      });
    });

  // Pesquisa
  const pesquisa = document.getElementById("barra-pesquisa");
  pesquisa.addEventListener("input", () => {
    const termo = pesquisa.value.toLowerCase();
    document.querySelectorAll("section").forEach(sec => {
      sec.style.display = sec.textContent.toLowerCase().includes(termo) ? "block" : "none";
    });
  });

  // Chatbot
  const chatInput = document.getElementById("chat-input");
  const chatEnviar = document.getElementById("chat-enviar");
  const chatMensagens = document.getElementById("chat-mensagens");

  const respostas = {
    ola: "OlÃ¡! ðŸ˜Š Como posso te ajudar?",
    horario: "Nosso horÃ¡rio de atendimento Ã© das 8h Ã s 18h.",
    medico: "Para agendar consulta, clique em ðŸ©º Agendamento MÃ©dico.",
    doacao: "VocÃª pode fazer uma doaÃ§Ã£o clicando em ðŸ’– DoaÃ§Ãµes.",
    reclamar: "Envie sua reclamaÃ§Ã£o em ðŸ“¢ ReclamaÃ§Ãµes.",
    default: "Desculpe, nÃ£o entendi. Tente outra pergunta!"
  };

  function responder(msg) {
    const p = document.createElement("p");
    p.textContent = "ðŸ‘¤ " + msg;
    chatMensagens.appendChild(p);

    const resposta = document.createElement("p");
    const chave = Object.keys(respostas).find(k => msg.toLowerCase().includes(k));
    resposta.textContent = "ðŸ¤– " + (respostas[chave] || respostas.default);
    chatMensagens.appendChild(resposta);

    chatMensagens.scrollTop = chatMensagens.scrollHeight;
  }

  chatEnviar.onclick = () => {
    if (chatInput.value.trim() !== "") {
      responder(chatInput.value);
      chatInput.value = "";
    }
  };
});

function abrirFormulario(tipo) {
  const area = document.getElementById("area-formularios");
  area.innerHTML = "";

  if (tipo === "doacoes") {
    area.innerHTML = `<h3>ðŸ’– DoaÃ§Ãµes</h3>
      <input type='text' placeholder='Seu nome'>
      <input type='number' placeholder='Valor (R$)'>
      <button onclick="alert('DoaÃ§Ã£o registrada!')">Enviar</button>`;
  }
  if (tipo === "reclamacoes") {
    area.innerHTML = `<h3>ðŸ“¢ ReclamaÃ§Ãµes</h3>
      <textarea placeholder='Descreva sua reclamaÃ§Ã£o'></textarea>
      <button onclick="alert('ReclamaÃ§Ã£o enviada!')">Enviar</button>`;
  }
  if (tipo === "agendamento") {
    area.innerHTML = `<h3>ðŸ©º Agendamento MÃ©dico</h3>
      <input type='text' placeholder='Nome do paciente'>
      <input type='date'>
      <button onclick="alert('Consulta agendada com sucesso!')">Agendar</button>`;
  }
}

function alternarChat() {
  document.getElementById("chat-body").classList.toggle("oculto");
}
